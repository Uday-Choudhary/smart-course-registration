generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model User {
  id             String         @id @default(uuid())
  email          String         @unique
  createdAt      DateTime       @default(now())
  full_name      String
  password       String
  roleId         Int
  address        String?
  birthday       String?
  bloodType      String?
  phone          String?
  sex            String?

  subjects       Json?
  notifications  Notification[]
  registrations  Registration[]
  
  // Faculty relations
  sectionCoursesTaught SectionCourse[]
  coursesTaught        Course[]        @relation("CourseFaculty")
  schedulesTaught      SectionSchedule[]
  
  role           Role           @relation(fields: [roleId], references: [id])
  waitlists      Waitlist[]
}


model Term {
  id       Int       @id @default(autoincrement())
  year     Int
  semester String
  courses  Course[]  
  sections Section[]
}

model Course {
  id          Int       @id @default(autoincrement())
  code        String    @unique
  title       String
  creditHours Int
  description String?
  termId      Int           
  term        Term @relation(fields: [termId], references: [id])
  
  sectionCourses SectionCourse[]
  faculties      User[]          @relation("CourseFaculty")
  deadline       Deadline?
}

model Deadline {
  id                Int      @id @default(autoincrement())
  courseId          Int      @unique
  course            Course   @relation(fields: [courseId], references: [id])
  registrationOpen  DateTime
  addDropStart      DateTime
  addDropEnd        DateTime
  registrationClose DateTime
  waitlistClose     DateTime
}

model Section {
  id            Int               @id @default(autoincrement())
  sectionCode   String
  capacity      Int
  termId        Int
  
  term          Term              @relation(fields: [termId], references: [id])
  
  sectionCourses SectionCourse[]
  registrations  Registration[]
  waitlists      Waitlist[]
}

model SectionCourse {
  id        Int      @id @default(autoincrement())
  sectionId Int
  courseId  Int
  facultyId String?

  section   Section  @relation(fields: [sectionId], references: [id])
  course    Course   @relation(fields: [courseId], references: [id])
  faculty   User?    @relation(fields: [facultyId], references: [id])
  
  schedules SectionSchedule[]

  @@unique([sectionId, courseId])
}

model Room {
  id        Int               @id @default(autoincrement())
  roomCode  String            @unique
  schedules SectionSchedule[]
}

model SectionSchedule {
  id              Int           @id @default(autoincrement())
  dayOfWeek       String
  startTime       DateTime
  endTime         DateTime
  roomId          Int
  sectionCourseId Int
  facultyId       String?

  sectionCourse   SectionCourse @relation(fields: [sectionCourseId], references: [id])
  room            Room          @relation(fields: [roomId], references: [id])
  faculty         User?         @relation(fields: [facultyId], references: [id])
}

model Registration {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  studentId String
  sectionId Int
  section   Section  @relation(fields: [sectionId], references: [id])
  student   User     @relation(fields: [studentId], references: [id])
}

model Waitlist {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  studentId String
  sectionId Int
  section   Section  @relation(fields: [sectionId], references: [id])
  student   User     @relation(fields: [studentId], references: [id])
}

model Notification {
  id        Int      @id @default(autoincrement())
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

